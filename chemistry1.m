function [t, u] = chemistry1(t0, tf, ngnd, Ef, u0, ng0, Tg0, Evg0, flg)global kB d e eps FF m mu xENTd    = Ef/100/ng0/1e-17; % _Td, reduced electric fieldn.N20   = x.N2*ng0; % _m-3, molecular nitrogen densityn.O20   = x.O2*ng0; % _m-3, molecular oxygen density%The next equation produce N2+ which converts quickly to O2+ with very high rate k.r197 and k.r200 or in N4+ via k.r165 which converts in turn in O2+ thru k.r222nu.N2p  = alexair(Ef,ng0,1); % 1/_s, ionization frequency for N2 (Aleksandrov:1995)nu.O2p  = alexair(Ef,ng0,2); % 1/_s, ionization frequency for N2 (Aleksandrov:1995)% nu.N2p  = air1(Ef,ng0,10); % 1/_s, ionization frequency for N2 (Aleksandrov:1995)% nu.O2p  = air1(Ef,ng0,10); % 1/_s, ionization frequency for N2 (Aleksandrov:1995)nu.i    = x.N2*nu.N2p+x.O2*nu.O2p; % 1/_s, ionization frequency air (Aleksandrov:1995)% nu.i    = air1(Ef,ng0,10); % morrowair(Ef,ng0,1); %ionization frequency (Morrow:1997)% nu.a2   = 6.7e-19*exp(-1.05*abs(5.3 - log(ENTd))^3)*(ENTd)^0.8; %1/s, two body attachment frequency (Benilov:2003), F coeff appears directly in the equadiffnu.a2   = morrowair(Ef,ng0,2); % 1/_s, two body attachment frequency (Morrow:1997)nu.a3   = morrowair(Ef,ng0,3); % 1/_s, three body attachment frequency (Morrow:1997)nu.O2a  = alexair(Ef,ng0,8); % 1/_s, metastable O2(a) production frequency (Alexandrov:1995)nu.N2A  = alexair(Ef,ng0,4); % 1/_s, metastable N2 production frequency (Alexandrov:1995)nu.N2a  = alexair(Ef,ng0,12); % 1/_s, N2(a') production frequency (Kossyi:1992, Aleksandrov:1995)nu.x1P  = alexair(Ef,ng0,5); % 1/_s, N2(B) production frequency (Alexandrov:19950nu.x2P  = alexair(Ef,ng0,7); % 1/_s, N2(C) production frequency (Alexandrov:1995)% Constants needed for calculations of cascade from C to B to A states of N2A.x1P   = 1.7e5; % 1/_s, Einstein coeff for B state (Aleksandrov:1995)A.x2P   = 2.e7; % 1/_s, Einstein coeff for C state (Aleksandrov:1995)alpha.x1PN2 = 1.e-11; % _cm3/_s, quenching coefficient of B state by N2 (Aleksandrov:1995)alpha.x2PO2 = 3.e-10; % _cm3/_s, quenching coefficient of C state by O2 (Aleksandrov:1995)k.dO2a  = 2.e-10; % _cm3/_s, detachment in collisions with metastables O2* (agrees with Lowke, Kossiy-58)k.dN2A  = 2.1e-9; % _cm3/_s, detachment in collisions with metastables N2* (A state; Kossyi 60)k.qN2A  = 7e-12; % _cm3/_s, quenching rate of matastable N2* by O (Kossyi-102)% The quenching rate of matastable N2* by O (VJ p. 119, 1.5e-11, see rate k102 in Kossyi) appears% to be two times lower (7e-12 _cm3/_s) than in VJ p. 119. This reaction also leads to production% of NO in ground state and in Simek et al., 1998 considered as primary% source of NO in streamer discharges. Simek values are 3-3.7e-11 _cm3/_s; we% use Kossiy value 7e-12 _cm3/_s.k.sqN2A = (1.6+0.77)*1e-10; % _cm3/_s, self-quenching rate of matastable N2(A) (Kossyi-104)% The self-quenching rate of matastable N2(A) with B and C state production% (Popov, 2001, see rate k104 in Kossiyi) appears to be an order of magniture lower% in accordance with some measurements, value 2e-12 _cm3/_s? Value corrected% on May 5, 2009 (see notes at the beginning of the file).k.q108  = 2.1e-11; % _cm3/_s, N2(A)+O=N2+O (Kossyi-108)k.d5    = 5.e-9*exp(-646/ENTd); % _cm3/_s, dissociation of N2 by electron impact (Benilov-5)k.d6    = 1.7e-8*exp(-324/ENTd); % _cm3/_s, dissociation of O2 by electron impact (Benilov-6, good agreement with Alexandrov)k.d22   = 9e-13; % _cm3/_s, O- + N2, dominant on early stage! (Benilov-22) k.d23   = 5.e-10; % _cm3/_s, O- +O next important after k22 (Benilov-23) k.d25   = 1.5e-10; % _cm3/_s, O2- + O (Benilov-25) k.d26   = 3.e-10; % _cm3/_s, O3- +O (Benilov-26) k.a48   = 1e-31; % _cm6/_s, (Kossyi-48)k.d50   = 1e-9; % _cm3/_s, (Kossyi-50)k.d51   = 1e-11; % _cm3/_s, (Kossyi-51)k.d62   = 3.e-10;  % _cm3/_s, O- + O2(a) (Kossyi-62)k.d64   = 2.2e-9;  % _cm3/_s, O- + N2(A) (Kossyi-64)k.dONO  = 2.6e-10; % _cm3/_s, O^-+NO=NO2+e (Benilov-65)k.d100  = 2.54e-12; % _cm3/_s, N2(A)+O2 = N2 +O +O (Kossyi-100)k.d115  = 2.8e-11; % _cm3/_s, N2(a')+O2 = N2 +O +O (Kossyi-115 and Popov)k.d200  = 1e-10; % _cm3/_s, (Kossyi-200)k.d222  = 2.5e-10; % _cm3/_s, (Kossyi-200)k.d228  = 1.e-10; % _cm3/_s, (Kossyi-228)k.d229  = 3.e-10; % _cm3/_s, (Kossyi-229)k.r237  = 3.3e-10; % _cm3/_s, (Kossyi-237)k.r242  = 1e-10; % _cm3/_s, (Kossyi-242)k.r247  = 3.2e-10; % _cm3/_s, (Kossyi-247)options = odeset('Vectorized','on','RelTol',eps,'AbsTol',ones(1,15)*eps,'Refine',1e0);T.v0    = d.Ev_eV/log(1+d.Ev/Evg0); % _eV, vibrational temperaturez       = exp(-d.Ev_eV/T.v0); % _C       = 6.5e3; % _Td^2F       = exp(C*z/ENTd^2); % _T.e0    = Tg0+34.6*Ef^0.46/(ng0/ngnd)^0.46; % _K, electron temperature% T.e0    = Tg0+2*air1(Ef,ng0,1)/3*(e/kB); % _K, electron temperatureT.p0    = Tg0+2*m.g/3/kB*(mu.p*Ef)^2; % _K, positive ion temperatureT.n0    = Tg0+2*m.g/3/kB*(mu.n*Ef)^2; % _K, negative ion temperatureT.eV0   = kB*Tg0/e; % _eV, gas temperaturek.r15   = 1.1e-10*sqrt(T.eV0); % _cm3/_s, (Benilov-15)k.r17   = 1.2e-10*T.eV0*exp(-0.27/T.eV0); % _cm3/_s, (Benilov-17)k.qO2a  = 2.2e-18*(Tg0/300).^.8; % _cm3/_s, quenching rate of matastable O2* by O2 (from Kossyi-123 and Lowke-6)%% Chemical constants% beta1   = 2.e-7*(300/Tg0)^0.5; % _cm3/_s, ion-ion recombination (Kossiy, Vidal)% beta    = (0.79*1e6*2.035e-12*T.e0^-0.39+0.21*1e6*1.138e-11*T.e0^-0.7)/2; % _cm3/_s, e-i recombination (Vidal, Zao)% beta    = 1e6*1.138e-11*T.e0^-0.7; % _cm3/_s, e-i recombination since O2+ is dominant ion (Naidis, Vidal, Zao, book 18 p.137)% beta    = 2e-7*(300/T.e0)^0.7;  % _cm3/_s, slightly different representation of the above formila from ZaoT.eff   = Tg0/11600+5.2e-6*ENTd.^2; % _eVteta    = .13*(11600/Tg0-1./T.eff);k.d21   = 2e-10*exp(-0.52./T.eff).*(1-exp(-4*teta))./(1-exp(-teta)); % _cm3/_s, detachment from O2- in collisions with O2 molecules (Benilov and Naidis)% k.d21   = 2.7e-10*(Tg0/300)^0.5*exp(-5590/Tg0);% _cm3/_s, detachment in collisions with O2 molecules (Benilov-21)T.eff1  = Tg0/11600+6.9e-6*ENTd.^2; % _eVk.a27   = 2.8e-32/T.eff1; % _cm6/_s, (Benilov-27)k.d29   = 0*2e-6*(300/T.e0).^.5; % _cm3/_s, (Kossyi-29)k.d38   = 2.8e-7*(300/T.e0).^.5; % _cm3/_s, (Kossyi-38)k.d39   = 2e-7*(300/T.e0).^.5; % _cm3/_s, (Kossyi-39)k.a40   = 2e-7*300/T.e0; % _cm3/_s, (Kossyi-40)k.a44   = 6e-27*(300/T.e0)^1.5; % _cm6/_s, e + O2+ + M -> O2 + M (Kossyi-44)% k.a40   = beta; %test only%These produce O4+ (has high recombination rate with electrons Alexandrov and Bazelyan PSST 8 285 1999 fig 1)k.r167  = flg.complex_ions*2.4e-30*(300/Tg0)^3.2; % _cm6/_s, O2+ + O2 + O2 -> O4+ + O2 (Kossyi-167)k.r232  = flg.complex_ions*1e-9; % _cm3/_s, O2+N2 + O2 -> O4+  + N2 (Kossyi-232)%These produce N4+ which converts quickly to O2+ with very high ratek.i25ass= 5e-11; % _cm3/_s, associative ionization (Kossyi-25, Popov)k.i26ass= 2e-10; % _cm3/_s, (Kossyi-26)k.a165  = 5e-29; % _cm6/_s, (Kossyi-165) %These produce NO+ and O+ which converts quickly to O2+ with very high ratek.iNO   = 5.e-9*exp(-460/ENTd); % _cm3/_s, ionization of NO by electron impact (Benilov-3)k.iO    = 4.e-9*exp(-713/ENTd); % _cm3/_s, ionization of O by electron impact (Benilov-4)%These produce O2+N2 which converts quickly to O4+ with very high rate k.r232k.r168  = flg.complex_ions*0.9e-30*(300/Tg0)^2; % _cm6/_s, O2+ + N2 + N2 -> O2+N2 + N2 (Kossyi-168)k.r226  = flg.complex_ions*4.61e-12*(Tg0/300)^2.5*exp(-2650/Tg0); % _cm3/_s, O4+ + N2 -> O2+N2 +O2 (Kossyi-226)%If above coefficients are set to zero the model operates with O2+ ion onlyk.r197  = 6e-11*(300/Tg0).^.5; % _cm6/_s, Kossyi-197k.a30   = 0*1.4e-6*(300/T.e0)^0.5; % _cm3/_s, (Kossyi-30)k.a34   = 0*1.3e-6*(300/T.e0)^0.5; % _cm3/_s, (Kossyi-34)k.d231  = 1.1e-6*(300/Tg0)^5.3*exp(-2357/Tg0); % _cm3/_s, (Kossyi-231)k.d227  = 3.3e-6*(300/Tg0)^4*exp(-5030/Tg0); % _cm3/_s, (Kossyi-227)k.I     = 2.e-7*(300/Tg0)^0.5; % _cm3/_s, (Kossyi-I)k.II    = 1.e-7; % _cm3/_s, (Kossyi-II)k.V     = flg.complex_chem*2e-25*(300/Tg0)^2.5; % _cm6/_s, (Kossyi-V)k.VI    = flg.complex_chem*2e-25*(300/Tg0)^2.5; % _cm6/_s, (Kossyi-VI)% This process leads to very fast removal% of O-, O2-, O3- in recombination reactions with O2+ and O4+ and no% transition to spark. O4+ is not listed as participant in three body% recombination in Kossyi => keep k.V=0 for now, April 25, 2009[t, u]  = ode113(@system,[t0 tf],u0, options);FF.iz   = [FF.iz (F*nu.i*u(1) + F*k.iNO*u(12)*u(1) + F*k.iO*u(10)*u(1))/u(1)]; % _s^-1, ionization rateFF.st   = [FF.st (k.i25ass*u(9)*u(8) + k.i26ass*u(8)*u(8))/u(1)]; % _s^-1, stepwise ionisation rateFF.a2   = [FF.a2 (F*nu.a2*u(1))/u(1)]; % _s^-1, 2-body attachment rateFF.a3   = [FF.a3 (nu.a3*u(1) + k.a48*n.O20*u(1)*u(10))/u(1)]; % _s^-1, 3-body attachment rateFF.ei   = [FF.ei (k.a30*u(1)*u(3) + k.a34*u(1)*u(4) + k.a40*u(1)*u(2) + k.a44*u(1)*u(2)*n.N20 + k.a44*u(1)*u(2)*n.O20)/u(1)]; % _s^-1, electron-ion recombination rateFF.de   = [FF.de (k.d62*u(7)*u(5) + k.d64*u(9)*u(5) + k.dO2a*u(7)*u(6) + k.dN2A*u(9)*u(6) + k.d21*u(6)*n.O20 + k.d22*u(5)*n.N20 + k.d23*u(5)*u(10) + k.d25*u(6)*u(10) + k.d26*n.O3m0*u(10) + k.dONO*u(5)*u(12))/u(1)]; % _s^-1, detachment rateFF.ex   = [FF.ex (nu.O2a*u(1) + F*nu.N2a*u(1) + F*nu.N2A*u(1) + nu.x1P*u(1) + nu.x2P*u(1))/u(1)]; % _s^-1, electron impact excitation rateFF.di   = [FF.di (F*k.d6*n.O20*u(1) + F*k.d5*n.N20*u(1))/u(1)]; % _s^-1, electron impact dissociation rateFF.gd   = [FF.gd (k.r15*u(11)*u(12) + k.r17*u(11)*n.O20)/u(1)]; % _s^-1, ground states chemistry rateFF.rd   = [FF.rd (A.x1P*n.N2B0 + A.x2P*n.N2C0 + alpha.x1PN2*n.N2B0*n.N20 + alpha.x2PO2*n.N2C0*n.O20 + k.qO2a*u(7)*n.O20 + k.qN2A*u(9)*u(10) + k.sqN2A*u(9)*u(9) + k.q108*u(9)*u(10) + k.d100*u(9)*n.O20 + k.d115*u(8)*n.O20)/u(1)]; % _s^-1, radicals chemistry rateFF.ii   = [FF.ii (k.I*u(5)*u(2) + k.I*u(6)*u(2) + k.I*n.O3m0*u(2) + k.II*u(2)*(u(5)+u(6)+n.O3m0) + k.II*u(3)*(u(5)+u(6)+n.O3m0) + k.II*u(4)*(u(5)+u(6)+n.O3m0))/u(1)]; % _s^-1, ion-ion recombination rateFF.ip   = [FF.ip (k.d228*u(3)*u(7) + k.d229*u(3)*u(10) + k.r167*u(2)*n.O20^2 + k.r232*u(4)*n.O20 + k.r168*u(2)*n.N20^2 + k.r226*u(3)*n.N20 + k.d231*u(4)*n.N20 + k.d227*u(3)*n.O20)/u(1)]; % _s^-1, positive ion chemistry rateFF.im   = [FF.im (k.r242*u(5)*u(7) + k.r237*u(6)*u(10) + k.r247*n.O3m0*u(10) + k.a27*u(5)*n.O20*ng0 )/u(1)]; % _s^-1, negative ion chemistry rate    function udot = system(t,u) %start of nested function needed for ode45 solution        n.O3m0  = u(2)+u(3)+u(4)+u(13)+u(14)-u(1)-u(5)-u(6); % _cm-3        n.N2C0  = (nu.x2P*u(1)+k.sqN2A*u(9)*u(9))/(A.x2P+alpha.x2PO2*n.O20); % _cm-3, number density of N2(C) (2P state) excited molecules        n.N2B0  = (nu.x1P*u(1)+n.N2C0*A.x2P)/(A.x1P+alpha.x1PN2*n.N20); % _cm-3, number density of N2(B) (1P state) excited molecules                %% system        udot=[...            (F*nu.N2p+nu.O2p-F*nu.a2-nu.a3)*u(1)-k.a30*u(1)*u(3)-k.a34*u(1)*u(4)-k.a40*u(1)*u(2)+k.d62*u(7)*u(5)+k.d64*u(9)*u(5)+k.dO2a*u(7)*u(6)+k.dN2A*u(9)*u(6)+k.d21*u(6)*n.O20+k.d22*u(5)*n.N20+k.d23*u(5)*u(10)+k.d25*u(6)*u(10)+k.d26*n.O3m0*u(10)+k.i25ass*u(9)*u(8)+k.i26ass*u(8)*u(8)+F*k.iNO*u(12)*u(1)+F*k.iO*u(10)*u(1)+k.dONO*u(5)*u(12)-k.a44*u(1)*u(2)*ng0-k.a44*u(1)*u(13)*ng0-k.a48*n.O20*u(1)*u(10)-k.d51*u(1)*u(15)-k.d50*u(1)*u(15)-F*k.d38*u(1)*u(13)-F*k.d39*u(1)*u(13)-k.d29*u(1)*u(14); ... % n.e, _m^-3 (1)            nu.O2p*u(1)-k.r167*u(2)*n.O20^2+k.d227*u(3)*n.O20+k.d228*u(3)*u(7)+k.d229*u(3)*u(10)-k.a40*u(1)*u(2)-k.r168*u(2)*n.N20^2+k.d231*u(4)*n.N20+F*k.iNO*u(12)*u(1)+F*k.iO*u(10)*u(1)-k.a44*u(1)*u(2)*ng0-k.I*u(2)*(u(5)+u(6)+n.O3m0)-k.II*u(2)*(n.O3m0+u(5)+u(6))-k.V*u(2)*u(5)*ng0-k.V*u(2)*u(6)*ng0-k.VI*u(2)*u(5)*ng0 + k.r197*u(13)*n.O20 + k.d200*u(13)*u(15) + k.d222*u(14)*n.O20; ... % n.O2+, _m^-3 (2)            k.r167*u(2)*n.O20^2-k.a30*u(3)*u(1)+k.r232*u(4)*n.O20-k.r226*u(3)*n.N20-k.d227*u(3)*n.O20-k.d228*u(3)*u(7)-k.d229*u(3)*u(10)-k.II*u(3)*(n.O3m0+u(5)+u(6)); ... % n.O4+, _m^-3 (3)            k.r168*u(2)*n.N20^2-k.d231*u(4)*n.N20-k.r232*u(4)*n.O20+k.r226*u(3)*n.N20-k.a34*u(1)*u(4)-k.II*u(4)*(n.O3m0+u(5)+u(6)); ... % n.O2+N2, _m^-3 (4)            F*nu.a2*u(1)-k.d22*u(5)*n.N20-k.d23*u(5)*u(10)-k.a27*u(5)*n.O20*ng0-k.d62*u(7)*u(5)-k.d64*u(9)*u(5)+k.r237*u(6)*u(10)-k.r242*u(5)*u(7)-k.dONO*u(5)*u(12)-k.I*u(5)*u(2)-k.II*u(5)*(u(2)+u(3)+u(4))-k.V*u(2)*u(5)*ng0-k.VI*u(5)*u(2)*ng0 + k.d51*u(1)*u(15) - k.I*u(5)*u(13) - k.II*u(5)*(u(13)+u(14)) - k.V*u(5)*u(13)*ng0 - k.VI*u(5)*u(13)*ng0; % n.O-, _m^-3 (5)            nu.a3*u(1)-k.d21*u(6)*n.O20-k.d25*u(6)*u(10)-k.dO2a*u(7)*u(6)-k.dN2A*u(9)*u(6)-k.r237*u(6)*u(10)+k.r242*u(5)*u(7)+k.r247*n.O3m0*u(10)+k.a48*n.O20*u(1)*u(10)-k.I*u(6)*u(2)-k.II*u(6)*(u(2)+u(3)+u(4))-k.V*u(2)*u(6)*ng0 + k.d50*u(1)*u(15)- k.I*u(6)*u(13) - k.II*u(6)*(u(13)+u(14)) - k.V*u(6)*u(13)*ng0; ... % n.O2-, _m^-3 (6)            nu.O2a*u(1)-k.dO2a*u(7)*u(6)-k.qO2a*u(7)*n.O20-k.d62*u(7)*u(5)-k.r242*u(5)*u(7)-k.d228*u(3)*u(7); ... % n.O2(a), _m^-3 (7)            F*nu.N2a*u(1)-k.i25ass*u(9)*u(8)-2*k.i26ass*u(8)*u(8)-k.d115*u(8)*n.O20; ... % n.N2(a'), _m^-3 (8)            F*nu.N2A*u(1)-k.dN2A*u(9)*u(6)-k.qN2A*u(9)*u(10)-k.q108*u(9)*u(10)-k.d64*u(9)*u(5)-k.d100*u(9)*n.O20-2*k.sqN2A*u(9)*u(9)-k.i25ass*u(9)*u(8)+A.x1P*n.N2B0; ... % n.N2(A), _m^-3 (9)            2*F*k.d6*n.O20*u(1)+F*nu.a2*u(1)-k.d23*u(5)*u(10)-k.d25*u(6)*u(10)-k.d26*n.O3m0*u(10)+2*k.a40*u(1)*u(2)+k.d64*u(9)*u(5)-k.q108*u(9)*u(10)+2.*k.d100*u(9)*n.O20+2.*k.d115*u(8)*n.O20-k.r237*u(6)*u(10)+k.r242*u(5)*u(7)-k.r247*n.O3m0*u(10)-F*k.iO*u(10)*u(1)+k.r15*u(11)*u(12)+k.r17*u(11)*n.O20-k.qN2A*u(9)*u(10)-k.d229*u(3)*u(10)+k.I*u(2)*u(5)+k.II*u(5)*(u(2)+u(3)+u(4))+2*k.II*u(2)*(u(5)+u(6)+n.O3m0)+k.V*u(2)*u(5)*ng0 + k.d50*u(1)*u(15) + k.I*u(5)*u(13) + k.II*u(5)*(u(13)+u(14)) + k.V*u(5)*u(13)*ng0 + k.d200*u(13)*u(15); % n.O, _m^-3 (10)            2*F*k.d5*n.N20*u(1)-k.r15*u(11)*u(12)-k.r17*u(11)*n.O20 + 2*F*k.d38*u(1)*u(13) + F*k.d39*u(1)*u(13) + 2*k.II*(u(5)+u(6)+n.O3m0)*u(13) ; ... % n.N, _m^-3 (11)            k.qN2A*u(9)*u(10)-F*k.iNO*u(12)*u(1)-k.dONO*u(5)*u(12)+k.r17*u(11)*n.O20-k.r15*u(11)*u(12); ... % n.NO, _m^-3 (12)            F*nu.N2p*u(1) - F*k.d38*u(1)*u(13) - F*k.d39*u(1)*u(13) - k.a44*u(1)*u(13)*ng0 - k.I*(u(5)+u(6)+n.O3m0)*u(13) - k.II*(u(5)+u(6)+n.O3m0)*u(13) - k.V*(u(5)+u(6))*u(13)*ng0 - k.VI*u(5)*u(13)*ng0 - k.a165*u(13)*n.N20*(n.N20+n.O20) - k.r197*u(13)*n.O20 - k.d200*u(13)*u(15); ... % n.N2+, _m^-3 (13)            k.i25ass*u(9)*u(8) + k.i26ass*u(8)*u(8) - k.d29*u(1)*u(14) + k.a165*u(13)*n.N20*(n.N20+n.O20) - k.II*(u(5)+u(6)+n.O3m0)*u(14) - k.d222*u(14)*n.O20; ... % n.N4+, _m^-3 (14)            k.d25*u(6)*u(10) + k.d62*u(7)*u(5) + k.I*u(2)*n.O3m0 + k.II*n.O3m0*(u(2)+u(3)+u(4)) + k.VI*u(2)*u(5)*ng0 + k.d229*u(3)*u(10) - k.d51*u(1)*u(15) - k.d50*u(1)*u(15) + k.I*n.O3m0*u(13) + k.II*n.O3m0*(u(13)+u(14)) - k.d200*u(13)*u(15)]; % n.O3, _m^-3 (15)            end % end of nested function systemend % end of main function chemistry